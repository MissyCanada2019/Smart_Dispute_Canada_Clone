{% extends "base.html" %}

{% block title %}Review Case | SmartDispute Canada{% endblock %}

{% block content %}
<div class="container mt-5">
    <h3 class="text-danger mb-3">Review Your Case</h3>

    <div class="card mb-4">
        <div class="card-body">
            <h5>Case: {{ case.title }}</h5>
            <p><strong>Court:</strong> {{ form_info.court }}</p>
            <p><strong>Form:</strong> {{ form_info.form_name }}</p>
            <p><strong>Merit Score:</strong> {{ merit_score }}%</p>
            <p class="text-muted">{{ explanation }}</p>
        </div>
    </div>

    <div class="alert alert-warning">
        <strong>Unlock Your Legal Form ($9.99)</strong><br>
        Pay securely by PayPal or send an e-transfer to: <br>
        <strong>smartdisputecanada@gmail.com</strong>
    </div>

    <div class="mb-3">
        <div id="paypal-button-container"></div>
    </div>

    <form method="POST" action="{{ url_for('confirm_payment', case_id=case.id) }}">
        <button type="submit" class="btn btn-secondary">I Paid by E-Transfer</button>
    </form>
</div>

<!-- PayPal Smart Button Script -->
<script src="https://www.paypal.com/sdk/js?client-id=sb&currency=CAD"></script>
<script>
    paypal.Buttons({
        style: {
            layout: 'horizontal',
            color:  'blue',
            shape:  'rect',
            label:  'pay'
        },
        createOrder: function(data, actions) {
            return actions.order.create({
                purchase_units: [{
                    amount: { value: '9.99' }
                }]
            });
        },
        onApprove: function(data, actions) {
            return actions.order.capture().then(function(details) {
                alert('Payment completed by ' + details.payer.name.given_name);
                fetch('{{ url_for("confirm_payment", case_id=case.id) }}', {
                    method: 'POST'
                }).then(() => window.location.reload());
            });
        }
    }).render('#paypal-button-container');
</script>
{% endblock %}
