{% extends "base.html" %}
{% block title %}Review Case{% endblock %}
{% block content %}
<div class="container mt-5">
  <h3 class="text-danger">Case Review</h3>
  <p><strong>Suggested Form:</strong> {{ form_info.form_name }}</p>
  <p><strong>Court:</strong> {{ form_info.court }}</p>
  <p><strong>Merit Score:</strong> {{ merit_score }}%</p>
  <p>{{ explanation }}</p>

  <div class="alert alert-warning">
    <strong>To unlock your form:</strong><br>
    Pay <strong>$9.99</strong> securely with PayPal or send e-transfer to <br>
    <strong>smartdisputecanada@gmail.com</strong>
  </div>

  <form id="etransfer-form" method="POST" action="{{ url_for('confirm_payment', case_id=case.id) }}">
    <input type="hidden" name="payment_id" value="manual-e-transfer">
    <button class="btn btn-secondary">I Paid by E-Transfer</button>
  </form>

  <div id="paypal-button-container" class="mt-3"></div>
</div>

<script src="https://www.paypal.com/sdk/js?client-id={{ PAYPAL_CLIENT_ID }}&currency=CAD"></script>
<script>
paypal.Buttons({
  createOrder: function(data, actions) {
    return actions.order.create({
      purchase_units: [{ amount: { value: '9.99' } }]
    });
  },
  onApprove: function(data, actions) {
    return actions.order.capture().then(function(details) {
      const form = document.createElement('form');
      form.method = 'POST';
      form.action = '{{ url_for("confirm_payment", case_id=case.id) }}';
      const hiddenField = document.createElement('input');
      hiddenField.type = 'hidden';
      hiddenField.name = 'payment_id';
      hiddenField.value = data.orderID;
      form.appendChild(hiddenField);
      document.body.appendChild(form);
      form.submit();
    });
  }
}).render('#paypal-button-container');
</script>
{% endblock %}
